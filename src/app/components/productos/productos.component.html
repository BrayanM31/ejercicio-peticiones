<div class="container">
  <h1 class="titulo-principal">Gestión de Productos</h1>

  <!-- Formulario de Producto -->
  <mat-card class="formulario-card">
    <mat-card-header>
      <mat-card-title>
        {{ editando ? 'Editar Producto' : 'Agregar Nuevo Producto' }}
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <form [formGroup]="productoForm" (ngSubmit)="guardarProducto()">
        <div class="form-row">
          <!-- Código del Producto -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Código del Producto</mat-label>
            <input matInput 
                   formControlName="codigo" 
                   placeholder="Ej: A001"
                   maxlength="10">
            <mat-icon matPrefix>qr_code</mat-icon>
            <mat-error *ngIf="codigo?.invalid && codigo?.touched">
              {{ obtenerErrorCodigo() }}
            </mat-error>
          </mat-form-field>

          <!-- Nombre del Producto -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Nombre del Producto</mat-label>
            <input matInput 
                   formControlName="nombre" 
                   placeholder="Ingrese el nombre">
            <mat-icon matPrefix>inventory_2</mat-icon>
            <mat-error *ngIf="nombre?.invalid && nombre?.touched">
              {{ obtenerErrorNombre() }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <!-- Costo -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Costo</mat-label>
            <input matInput 
                   type="number" 
                   formControlName="costo" 
                   placeholder="0.00"
                   step="0.01">
            <span matPrefix>$&nbsp;</span>
            <mat-error *ngIf="costo?.invalid && costo?.touched">
              {{ obtenerErrorCosto() }}
            </mat-error>
          </mat-form-field>

          <!-- Precio -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Precio (10-100)</mat-label>
            <input matInput 
                   type="number" 
                   formControlName="precio" 
                   placeholder="0.00"
                   step="0.01">
            <span matPrefix>$&nbsp;</span>
            <mat-error *ngIf="precio?.invalid && precio?.touched">
              {{ obtenerErrorPrecio() }}
            </mat-error>
          </mat-form-field>

          <!-- Valor -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Valor</mat-label>
            <input matInput 
                   type="number" 
                   formControlName="valor" 
                   placeholder="0.00"
                   step="0.01">
            <span matPrefix>$&nbsp;</span>
            <mat-error *ngIf="valor?.invalid && valor?.touched">
              {{ obtenerErrorValor() }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Botones de acción -->
        <div class="botones-accion">
          <button mat-raised-button 
                  color="primary" 
                  type="submit"
                  [disabled]="productoForm.invalid">
            <mat-icon>{{ editando ? 'save' : 'add' }}</mat-icon>
            {{ editando ? 'Actualizar' : 'Agregar' }} Producto
          </button>

          <button mat-raised-button 
                  color="warn" 
                  type="button"
                  *ngIf="editando"
                  (click)="cancelarEdicion()">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Tabla de Productos -->
  <mat-card class="tabla-card" *ngIf="productos.length > 0">
    <mat-card-header>
      <mat-card-title>Lista de Productos</mat-card-title>
      <mat-card-subtitle>Total: {{ productos.length }} producto(s)</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <div class="tabla-container">
        <table mat-table [dataSource]="productos" class="mat-elevation-z2">
          
          <!-- Columna Código -->
          <ng-container matColumnDef="codigo">
            <th mat-header-cell *matHeaderCellDef>Código</th>
            <td mat-cell *matCellDef="let producto">{{ producto.codigo }}</td>
          </ng-container>

          <!-- Columna Nombre -->
          <ng-container matColumnDef="nombre">
            <th mat-header-cell *matHeaderCellDef>Nombre</th>
            <td mat-cell *matCellDef="let producto">{{ producto.nombre }}</td>
          </ng-container>

          <!-- Columna Costo -->
          <ng-container matColumnDef="costo">
            <th mat-header-cell *matHeaderCellDef>Costo</th>
            <td mat-cell *matCellDef="let producto">
              ${{ producto.costo | number:'1.2-2' }}
            </td>
          </ng-container>

          <!-- Columna Precio -->
          <ng-container matColumnDef="precio">
            <th mat-header-cell *matHeaderCellDef>Precio</th>
            <td mat-cell *matCellDef="let producto">
              ${{ producto.precio | number:'1.2-2' }}
            </td>
          </ng-container>

          <!-- Columna Valor -->
          <ng-container matColumnDef="valor">
            <th mat-header-cell *matHeaderCellDef>Valor</th>
            <td mat-cell *matCellDef="let producto">
              ${{ producto.valor | number:'1.2-2' }}
            </td>
          </ng-container>

          <!-- Columna Acciones -->
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let producto; let i = index">
              <button mat-icon-button 
                      color="primary"
                      (click)="editarProducto(producto, i)"
                      matTooltip="Editar">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button 
                      color="warn"
                      (click)="eliminarProducto(i)"
                      matTooltip="Eliminar">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Mensaje cuando no hay productos -->
  <mat-card class="mensaje-vacio" *ngIf="productos.length === 0">
    <mat-card-content>
      <mat-icon class="icono-vacio">inventory</mat-icon>
      <p>No hay productos registrados. ¡Agrega el primero!</p>
    </mat-card-content>
  </mat-card>
</div>